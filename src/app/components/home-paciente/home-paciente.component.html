<div class="home-container">
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <div class="brand">
        <h1>Clinimed</h1>
        <span class="subtitle">Panel de Paciente</span>
      </div>
      <div class="user-info">
        <div class="user-details">
          <span class="user-name">{{ usuario?.nombre }} {{ usuario?.apellido }}</span>
          <span class="user-role">Paciente</span>
        </div>
        <button class="logout-btn" (click)="logout()">
          <span class="logout-icon">üö™</span>
          Cerrar Sesi√≥n
        </button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Welcome Section -->
    <section class="welcome-section">
      <div class="welcome-card">
        <h2>¬°Bienvenido/a, {{ usuario?.nombre }}!</h2>
        <p class="welcome-message">
          Desde aqu√≠ puedes gestionar tus citas m√©dicas, ver tus ex√°menes y acceder a todos nuestros servicios.
        </p>
        <p class="current-time">{{ currentTime }}</p>
      </div>
    </section>

    <!-- Quick Actions -->
    <section class="actions-section">
      <h3>Acciones R√°pidas</h3>
      <div class="actions-grid">
        <div class="action-card primary" (click)="solicitarExamen()">
          <div class="action-icon">üìÖ</div>
          <h4>Solicitar Examen</h4>
          <p>Agenda un nuevo examen m√©dico</p>
        </div>

        <div class="action-card secondary" (click)="consultarExamenes()">
          <div class="action-icon">üîç</div>
          <h4>Consultar Reservas</h4>
          <p>Revisa tus reservas de ex√°menes</p>
        </div>

        <div class="action-card tertiary" (click)="cancelarExamen()">
          <div class="action-icon">‚ùå</div>
          <h4>Anular Reservas</h4>
          <p>Cancela una reserva de examen</p>
        </div>
      </div>
    </section>

    <!-- Services Section -->
    <section class="services-section">
      <h3>Servicios Disponibles</h3>
      <div class="services-grid">
        <div class="service-card" (click)="verResultados()">
          <div class="action-icon">üìä</div>
          <h4>Resultados</h4>
          <p>Revisa los resultados de tus ex√°menes</p>
        </div>

        <div class="service-card" (click)="verHistorial()">
          <div class="service-icon">üìã</div>
          <h4>Historial M√©dico</h4>
          <p>Accede a tu historial completo</p>
        </div>

        <div class="service-card" (click)="editarPerfil()">
          <div class="service-icon">üë§</div>
          <h4>Mi Perfil</h4>
          <p>Actualiza tu informaci√≥n personal</p>
        </div>

        <div class="service-card">
          <div class="service-icon">üíä</div>
          <h4>Medicamentos</h4>
          <p>Consulta tu plan de medicamentos</p>
        </div>

        <div class="service-card">
          <div class="service-icon">üè•</div>
          <h4>Cl√≠nicas</h4>
          <p>Encuentra cl√≠nicas cercanas</p>
        </div>

        <div class="service-card">
          <div class="service-icon">üìû</div>
          <h4>Contacto</h4>
          <p>Comun√≠cate con nosotros</p>
        </div>
      </div>
    </section>

    <!-- Info Section -->
    <section class="info-section">
      <div class="info-card">
        <h3>Informaci√≥n Importante</h3>
        <ul>
          <li><strong>Pr√≥ximas citas:</strong> No tienes citas programadas</li>
          <li><strong>Ex√°menes pendientes:</strong> No tienes ex√°menes pendientes</li>
          <li><strong>Resultados disponibles:</strong> No hay resultados nuevos</li>
        </ul>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-content">
      <p>&copy; 2025 Clinimed - Sistema de Gesti√≥n de Cl√≠nicas y Ex√°menes</p>
      <p>Versi√≥n 1.0.0</p>
    </div>
  </footer>
</div>

<!-- ========== MODAL SOLICITAR EXAMEN ========== -->
<div class="modal-overlay" *ngIf="showSolicitarModal" (click)="closeSolicitarModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Solicitar Examen</h2>
      <button class="close-btn" (click)="closeSolicitarModal()">&times;</button>
    </div>

    <div class="modal-body">
      <form (ngSubmit)="enviarSolicitud()">
        <div class="form-group">
          <label for="analisis">Tipo de Examen *</label>
          <select 
            id="analisis" 
            [(ngModel)]="nuevaSolicitud.analisisId" 
            name="analisis"
            class="form-control"
            [disabled]="loading"
            required>
            <option value="0">{{ loading ? 'Cargando...' : 'Selecciona un examen' }}</option>
            <option *ngFor="let analisis of analisisList" [value]="analisis.id">
              {{ analisis.nombre }} - {{ analisis.descripcion }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label for="laboratorio">Laboratorio *</label>
          <select 
            id="laboratorio" 
            [(ngModel)]="nuevaSolicitud.laboratorioId" 
            name="laboratorio"
            class="form-control"
            [disabled]="loading"
            required>
            <option value="0">{{ loading ? 'Cargando...' : 'Selecciona un laboratorio' }}</option>
            <option *ngFor="let lab of laboratoriosList" [value]="lab.id">
              {{ lab.nombre }} - {{ lab.direccion }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label for="fecha">Fecha de Solicitud *</label>
          <input 
            type="date" 
            id="fecha" 
            [(ngModel)]="nuevaSolicitud.fecha" 
            name="fecha"
            class="form-control"
            [disabled]="loading"
            required>
        </div>

        <div *ngIf="errorMessage" class="alert alert-danger">
          {{ errorMessage }}
        </div>

        <div *ngIf="successMessage" class="alert alert-success">
          {{ successMessage }}
        </div>

        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" (click)="closeSolicitarModal()" [disabled]="loading">
            Cancelar
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="loading">
            <span *ngIf="loading">Enviando...</span>
            <span *ngIf="!loading">Solicitar Examen</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- ========== MODAL CONSULTAR RESERVAS ========== -->
<div class="modal-overlay" *ngIf="showConsultarModal" (click)="closeConsultarModal()">
  <div class="modal-content large" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Mis Reservas de Ex√°menes</h2>
      <button class="close-btn" (click)="closeConsultarModal()">&times;</button>
    </div>

    <div class="modal-body">
      <div *ngIf="loading" class="loading-spinner">Cargando reservas...</div>

      <div *ngIf="!loading && misSolicitudes.length === 0" class="empty-state">
        <p>No tienes reservas de ex√°menes</p>
      </div>

      <div *ngIf="!loading && misSolicitudes.length > 0" class="solicitudes-list">
        <div class="solicitud-item" *ngFor="let solicitud of misSolicitudes">
          <div class="solicitud-header">
            <span class="solicitud-id">Reserva #{{ solicitud.id }}</span>
            <span class="solicitud-fecha">{{ solicitud.fechaSolicitud | date:'dd/MM/yyyy' }}</span>
          </div>
          <div class="solicitud-details">
            <div class="detail-row">
              <strong>Examen:</strong>
              <span>{{ solicitud.analisis?.nombre || getNombreAnalisis(solicitud.analisisId) }}</span>
            </div>
            <div class="detail-row">
              <strong>Laboratorio:</strong>
              <span>{{ solicitud.laboratorio?.nombre || getNombreLaboratorio(solicitud.laboratorioId) }}</span>
            </div>
            <div class="detail-row" *ngIf="solicitud.laboratorio?.direccion">
              <strong>Direcci√≥n:</strong>
              <span>{{ solicitud.laboratorio.direccion }}</span>
            </div>
            <div class="detail-row" *ngIf="solicitud.estado">
              <strong>Estado:</strong>
              <span class="badge badge-{{solicitud.estado}}">{{ solicitud.estado }}</span>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="errorMessage" class="alert alert-danger">
        {{ errorMessage }}
      </div>

      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" (click)="closeConsultarModal()">
          Cerrar
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ========== MODAL ANULAR RESERVAS ========== -->
<div class="modal-overlay" *ngIf="showAnularModal" (click)="closeAnularModal()">
  <div class="modal-content large" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Anular Reservas</h2>
      <button class="close-btn" (click)="closeAnularModal()">&times;</button>
    </div>

    <div class="modal-body">
      <div *ngIf="loading" class="loading-spinner">Cargando reservas...</div>

      <div *ngIf="!loading && misSolicitudes.length === 0" class="empty-state">
        <p>No tienes reservas para anular</p>
      </div>

      <div *ngIf="!loading && misSolicitudes.length > 0" class="solicitudes-list">
        <div class="solicitud-item" *ngFor="let solicitud of misSolicitudes">
          <div class="solicitud-header">
            <span class="solicitud-id">Reserva #{{ solicitud.id }}</span>
            <span class="solicitud-fecha">{{ solicitud.fechaSolicitud | date:'dd/MM/yyyy' }}</span>
          </div>
          <div class="solicitud-details">
            <div class="detail-row">
              <strong>Examen:</strong>
              <span>{{ solicitud.analisis?.nombre || getNombreAnalisis(solicitud.analisisId) }}</span>
            </div>
            <div class="detail-row">
              <strong>Laboratorio:</strong>
              <span>{{ solicitud.laboratorio?.nombre || getNombreLaboratorio(solicitud.laboratorioId) }}</span>
            </div>
            <div class="detail-row" *ngIf="solicitud.estado">
              <strong>Estado:</strong>
              <span class="badge badge-{{solicitud.estado}}">{{ solicitud.estado }}</span>
            </div>
          </div>
          <div class="solicitud-actions">
            <button 
              class="btn btn-danger btn-sm" 
              (click)="anularSolicitud(solicitud.id)"
              [disabled]="loading">
              Anular Reserva
            </button>
          </div>
        </div>
      </div>

      <div *ngIf="errorMessage" class="alert alert-danger">
        {{ errorMessage }}
      </div>

      <div *ngIf="successMessage" class="alert alert-success">
        {{ successMessage }}
      </div>

      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" (click)="closeAnularModal()">
          Cerrar
        </button>
      </div>
    </div>
  </div>
</div>
