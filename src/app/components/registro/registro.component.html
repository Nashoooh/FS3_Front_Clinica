<div class="registro-container">
  <div class="registro-card">
    <div class="registro-header">
      <h1>Clinimed</h1>
      <p>Crear Nueva Cuenta</p>
    </div>

    <form [formGroup]="registroForm" (ngSubmit)="onSubmit()" class="registro-form">
      <div class="form-row">
        <div class="form-group">
          <label for="nombre">Nombre *</label>
          <input 
            type="text" 
            id="nombre" 
            formControlName="nombre" 
            class="form-control"
            [class.is-invalid]="f['nombre'].invalid && f['nombre'].touched"
            placeholder="Ingresa tu nombre">
          <div *ngIf="f['nombre'].invalid && f['nombre'].touched" class="invalid-feedback">
            <div *ngIf="f['nombre'].errors?.['required']">El nombre es requerido</div>
            <div *ngIf="f['nombre'].errors?.['minlength']">El nombre debe tener al menos 2 caracteres</div>
          </div>
        </div>

        <div class="form-group">
          <label for="apellido">Apellido *</label>
          <input 
            type="text" 
            id="apellido" 
            formControlName="apellido" 
            class="form-control"
            [class.is-invalid]="f['apellido'].invalid && f['apellido'].touched"
            placeholder="Ingresa tu apellido">
          <div *ngIf="f['apellido'].invalid && f['apellido'].touched" class="invalid-feedback">
            <div *ngIf="f['apellido'].errors?.['required']">El apellido es requerido</div>
            <div *ngIf="f['apellido'].errors?.['minlength']">El apellido debe tener al menos 2 caracteres</div>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label for="email">Correo Electrónico *</label>
        <input 
          type="email" 
          id="email" 
          formControlName="email" 
          class="form-control"
          [class.is-invalid]="f['email'].invalid && f['email'].touched"
          placeholder="correo@ejemplo.com">
        <div *ngIf="f['email'].invalid && f['email'].touched" class="invalid-feedback">
          <div *ngIf="f['email'].errors?.['required']">El correo electrónico es requerido</div>
          <div *ngIf="f['email'].errors?.['email']">Ingresa un correo electrónico válido</div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="password">Contraseña *</label>
          <input 
            type="password" 
            id="password" 
            formControlName="password" 
            class="form-control"
            [class.is-invalid]="f['password'].invalid && f['password'].touched"
            placeholder="Mínimo 6 caracteres">
          <div *ngIf="f['password'].invalid && f['password'].touched" class="invalid-feedback">
            <div *ngIf="f['password'].errors?.['required']">La contraseña es requerida</div>
            <div *ngIf="f['password'].errors?.['minlength']">La contraseña debe tener al menos 6 caracteres</div>
          </div>
        </div>

        <div class="form-group">
          <label for="confirmPassword">Confirmar Contraseña *</label>
          <input 
            type="password" 
            id="confirmPassword" 
            formControlName="confirmPassword" 
            class="form-control"
            [class.is-invalid]="f['confirmPassword'].invalid && f['confirmPassword'].touched"
            placeholder="Repite tu contraseña">
          <div *ngIf="f['confirmPassword'].invalid && f['confirmPassword'].touched" class="invalid-feedback">
            <div *ngIf="f['confirmPassword'].errors?.['required']">Confirma tu contraseña</div>
            <div *ngIf="f['confirmPassword'].errors?.['passwordMismatch']">Las contraseñas no coinciden</div>
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="rut">RUT *</label>
          <input 
            type="text" 
            id="rut" 
            formControlName="rut" 
            class="form-control"
            [class.is-invalid]="f['rut'].invalid && f['rut'].touched"
            placeholder="12345678-9"
            (input)="formatRut($event)">
          <div *ngIf="f['rut'].invalid && f['rut'].touched" class="invalid-feedback">
            <div *ngIf="f['rut'].errors?.['required']">El RUT es requerido</div>
            <div *ngIf="f['rut'].errors?.['pattern']">Formato de RUT inválido (ej: 12345678-9)</div>
          </div>
        </div>

        <div class="form-group">
          <label for="telefono">Teléfono *</label>
          <input 
            type="tel" 
            id="telefono" 
            formControlName="telefono" 
            class="form-control"
            [class.is-invalid]="f['telefono'].invalid && f['telefono'].touched"
            placeholder="987654321">
          <div *ngIf="f['telefono'].invalid && f['telefono'].touched" class="invalid-feedback">
            <div *ngIf="f['telefono'].errors?.['required']">El teléfono es requerido</div>
            <div *ngIf="f['telefono'].errors?.['pattern']">El teléfono debe tener 8 o 9 dígitos</div>
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="fechaNacimiento">Fecha de Nacimiento *</label>
          <input 
            type="date" 
            id="fechaNacimiento" 
            formControlName="fechaNacimiento" 
            class="form-control"
            [class.is-invalid]="f['fechaNacimiento'].invalid && f['fechaNacimiento'].touched">
          <div *ngIf="f['fechaNacimiento'].invalid && f['fechaNacimiento'].touched" class="invalid-feedback">
            <div *ngIf="f['fechaNacimiento'].errors?.['required']">La fecha de nacimiento es requerida</div>
          </div>
        </div>

        <div class="form-group">
          <label for="genero">Género *</label>
          <select 
            id="genero" 
            formControlName="genero" 
            class="form-control"
            [class.is-invalid]="f['genero'].invalid && f['genero'].touched">
            <option value="">Selecciona tu género</option>
            <option value="M">Masculino</option>
            <option value="F">Femenino</option>
            <option value="Otro">Otro</option>
          </select>
          <div *ngIf="f['genero'].invalid && f['genero'].touched" class="invalid-feedback">
            <div *ngIf="f['genero'].errors?.['required']">El género es requerido</div>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label for="direccion">Dirección *</label>
        <input 
          type="text" 
          id="direccion" 
          formControlName="direccion" 
          class="form-control"
          [class.is-invalid]="f['direccion'].invalid && f['direccion'].touched"
          placeholder="Ingresa tu dirección completa">
        <div *ngIf="f['direccion'].invalid && f['direccion'].touched" class="invalid-feedback">
          <div *ngIf="f['direccion'].errors?.['required']">La dirección es requerida</div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="previsionId">Previsión de Salud *</label>
          <select 
            id="previsionId" 
            formControlName="previsionId" 
            class="form-control"
            [class.is-invalid]="f['previsionId'].invalid && f['previsionId'].touched"
            [disabled]="loadingCatalogos">
            <option value="">{{ loadingCatalogos ? 'Cargando...' : 'Selecciona tu previsión' }}</option>
            <option *ngFor="let prevision of previsiones" [value]="prevision.id">
              {{ prevision.nombre }}
            </option>
          </select>
          <div *ngIf="f['previsionId'].invalid && f['previsionId'].touched" class="invalid-feedback">
            <div *ngIf="f['previsionId'].errors?.['required']">La previsión de salud es requerida</div>
          </div>
        </div>

        <div class="form-group">
          <label for="rolId">Tipo de Usuario *</label>
          <select 
            id="rolId" 
            formControlName="rolId" 
            class="form-control"
            [class.is-invalid]="f['rolId'].invalid && f['rolId'].touched"
            [disabled]="loadingCatalogos">
            <option value="">{{ loadingCatalogos ? 'Cargando...' : 'Selecciona el tipo' }}</option>
            <option *ngFor="let rol of roles" [value]="rol.id">
              {{ rol.nombre }}
            </option>
          </select>
          <div *ngIf="f['rolId'].invalid && f['rolId'].touched" class="invalid-feedback">
            <div *ngIf="f['rolId'].errors?.['required']">El tipo de usuario es requerido</div>
          </div>
        </div>
      </div>

      <div *ngIf="errorMessage" class="alert alert-danger">
        {{ errorMessage }}
      </div>

      <div *ngIf="successMessage" class="alert alert-success">
        {{ successMessage }}
      </div>

      <button 
        type="submit" 
        class="btn btn-primary btn-block"
        [disabled]="loading || registroForm.invalid">
        <span *ngIf="loading" class="spinner"></span>
        {{ loading ? 'Registrando...' : 'Registrar Usuario' }}
      </button>
    </form>

    <div class="registro-footer">
      <p>
        ¿Ya tienes cuenta? 
        <a href="#" (click)="goToLogin()" class="login-link">
          Inicia sesión aquí
        </a>
      </p>
    </div>
  </div>
</div>
